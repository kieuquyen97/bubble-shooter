<!-- 
Bai kiem tra javascript
Mon Lap trinh Web
MSSV: <<Sinh Vien dien vao>>
Ho Ten: <<Sinh Vien dien vao>>

Ngay : 03. ---, 2010 -->
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Javascript</title>

	<!-- Meta Tags -->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="generator" content="" />

	<!-- CSS -->
	<link rel="stylesheet" href="css/structure.css" type="text/css" />
	<link rel="stylesheet" href="css/form.css" type="text/css" />
	<script>
		function nhapSo(evt)
		{
			//alert(evt.charCode);
			 var form = document.form1;
			if(evt.charCode >= 48 && evt.charCode <= 57)
			{
				return true;
			}
			if(evt.charCode == 0)
				return true;
		return false;
		}
		
		function trim(s)
		{
		   var l=0; var r=s.length -1;
		  while(l < s.length && s[l] == ' ')
		   {     
				l++; 
		   }
		  while(r > l && s[r] == ' ')
		   {    
				r-=1;    
		   }
		   return s.substring(l, r+1);
		} 
		
		function kiemTra()
		{
			if(kiemTraA() == false)
			{
			return false;
			}
			
			if(kiemTraDV() == false)
			{
				return false;
			}
			
			if(kiemTraAnSang() == false )
			{
				return false;
			}
			
			return true;
		}
		
		function kiemTraA()
		{
			if(trim(document.form1.txtHoTen.value).length == 0)
			{
				alert("Chưa nhập 'Họ tên'");
				return false;
			}
			
			if(trim(document.form1.txtCMND.value).length == 0)
			{
				alert("Chưa nhập 'CMND'");
				return false;
			}
			
			if(trim(document.form1.txtTinhTien.value).length == 0)
			{
				alert("Phải click vào 'Tính đơn giá' để tính đơn giá để hiện 'Đơn giá một ngày'");
				return false;
			}
			
			return true;
		}
		
		function kiemTraDV()
		{
			var form = document.form1;
			if (form.chkAnSang.checked ||
			form.chkGiatUi.checked ||
			form.chkSachBao.checked )
			{
				return true;
			}
		alert('Phải chọn ít nhất 1 dịch vụ đi kèm.');
		return false;
		}
		
		function kiemTraAnSang()
		{
			var form = document.form1;
			if(form.cboMucGia.value == "b" || form.cboMucGia.value == "c")
			{
				//alert("test");
				if (form.chkAnSang.checked)
					return true;
				alert("Mức giá loại sang trọng, đặc biệt phải có dịch vụ ăn sáng đi kèm");
				return false;
			}
			return true;
		}
		
		function Initialize() 
		{
  			SetToday(document.form1);
		}
		function SetToday(form) {
		  var now = new Date();
		  var day = now.getDate();
		  var month = now.getMonth();
		  var year = now.getFullYear();
		  form.d.value = day;
		  form.m.value = month + 1;
		  form.y.value = year;
		}
function nhapSoDate(evt)
{
	//alert(evt.charCode);
	 var form = document.form1;
	 form.time.value =0;
	 form.dd.value = "";
	 form.mm.value = "";
	 form.yy.value = "";
	if(evt.charCode >= 48 && evt.charCode <= 57)
	{
		return true;
	}
	if(evt.charCode == 0)
		return true;
		
	return false;
}

	function kiemTraTime()
	{
		var hopLy = true;
		var form = document.form1;
		if(trim(form.d.value) == "" || trim(form.m.value) == "" || trim(form.y.value) == "" )
		{
			alert("Bạn nhập thiếu nội dung của 'Ngày Thuê' \nHệ thống tự cập nhật ngày tháng hiện tại");
			Initialize();
			compute() ;
		}
		else if( parseFloat(trim(form.m.value)) == 0 || parseFloat(trim(form.m.value)) > 12 || parseFloat(trim(form.d.value)) == 0 )
		{
			alert("Ngày thuê không tồn tại");
		}
		else
			compute() ;
			
		function compute() 
		{
			var y2 = parseFloat(stripBad(form.y.value));
			var y3a = y2 ;
		
			var nday = new Array(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);
			nday[1] = (0 == y2 % 4) && (0 != y2 % 100) || (0 == y2 % 400) ? 29 : 28;
			
			var xas = parseFloat(form.d.value);
			var xas2 =parseFloat(form.m.value)-1;
		
			if (xas > nday[xas2])
			{
			 alert("Ngày thuê không tồn tại");
			 hopLy=false;
			}
		   if(hopLy == true)
		   {
			   if(form.time.value == 0)
			   {
				   form.dd.value = "";
				   form.mm.value = "";
				   form.yy.value = "";
			   }
			   else
			   {
					var tempXas = xas + parseFloat(form.time.value);
					if(tempXas > nday[xas2])
					{
						form.dd.value = tempXas - nday[xas2];
						form.mm.value = xas2 + 2;
						if(parseFloat(form.mm.value) > 12)
						{
							form.yy.value = parseFloat(form.y.value) + 1;
							form.mm.value = 1;
						}
						else
							form.yy.value = form.y.value
					}
					else
					{
						form.dd.value = tempXas;
						form.mm.value = form.m.value;
						form.yy.value = form.y.value;
					}
			   }
		   }
		}
	}
	function stripBad(string) {
		for (var i=0, output='', valid="eE-0123456789."; i<string.length; i++)
		   if (valid.indexOf(string.charAt(i)) != -1)
			  output += string.charAt(i)
		return output;
	}
	function tinhDonGia()
	{
		var form = document.form1;
		var gia = 150000;
		if(form.cboMucGia.value == "b")
			gia = 300000;
		else if(form.cboMucGia.value == "c")
			gia = 500000;
		if(form.cboLoaiPhong.value == "b")
			gia = gia *1.8;
		else if(form.cboLoaiPhong.value == "c")
			gia = gia * 3;
		var tongGia = gia;
		if (form.chkAnSang.checked && form.cboMucGia.value != "b" && form.cboMucGia.value != "c")
		{
			tongGia = tongGia + (0.05 * gia);
		}
		if (form.chkGiatUi.checked)
		{
			tongGia = tongGia + (0.05 * gia);
		}
		if (form.chkSachBao.checked)
		{
			tongGia = tongGia + (0.05 * gia);
		}
		
		form.txtTinhTien.value = tongGia;
	}
	</script>
</head>

<body id="public" onload="Initialize();">
<div id="container">
<form id="frm" name="form1" class="sgu  page" autocomplete="off" enctype="multipart/form-data" method="get" action="."  onsubmit="return kiemTra();">

	<div class="info">
		<h2 align="center">Phiếu đặt phòng</h2>
		<div></div>
	</div>

	<ul>
		<li id="foli1" class="">
        	<label class="desc" id="title1" for="Field1"> Họ tên *</label>
			<div class="col"><input id="Field1" name="txtHoTen" type="text" class="field text large" value="" maxlength="255" tabindex="1"/></div>
		</li>
		<li id="foli2" class="">
        	<label class="desc" id="title2" for="Field2"> Địa chỉ</label>
			<div class="col"><input id="Field2" name="txtDiaChi" type="text" class="field text large" value="" maxlength="255" tabindex="2"/></div>
		</li>
		<li id="foli3" class="">
        	<label class="desc" id="title3"	for="Field3"> Số chứng minh nhân dân *</label>
			<div class="col"><input id="Field3" name="txtCMND" type="text"	class="field text large" value="" maxlength="255" tabindex="3" onkeypress="return nhapSo(event);"/></div>
		</li>

		<li id="foli4" class="leftHalf">
        	<label class="desc" id="title4" for="Field4"> Mức giá </label>
			<div>
            	<select id="Field4" name="cboMucGia" class="field select medium" tabindex="4">
					<option value="a">Loại thường</option>
					<option value="b">Loại sang trọng</option>
					<option value="c">Loại đặc biệt</option>
				</select>
            </div>
		</li>

		<li id="foli5" class="rightHalf">
        	<label class="desc" id="title5" for="Field5"> Loại phòng </label>
          	<div>
            	<select id="Field5" name="cboLoaiPhong" class="field select medium" tabindex="5">
                	<option value="a">Phòng đơn</option>
                  	<option value="b">Phòng đôi</option>
                  	<option value="c">Phòng tập thể</option>
              	</select>
          	</div>
		</li>


      <li id="foli6" class="leftHaft">
          <label class="desc" id="title6" for="Field6"> Thời gian thuê </label>
          <div class="col">
              <select id="Field6" name="time" class="field select medium" tabindex="6" onchange="kiemTraTime();">
                  <option value="0">[Chọn thời gian thuê]</option>
                  <option value="1">Một ngày</option>
                  <option value="7">Một tuần</option>
                  <option value="30">Một tháng</option>
              </select>
          </div>
      </li>
  
      <li id="foli7" class="date leftHalf">
          <label class="desc" id="title7" for="Field7"> Ngày thuê </label> 
          <span> 
              <input id="Field71" name="m" type="text" class="field text" value="" size="2" maxlength="2" tabindex="7" onkeypress="return nhapSoDate(event);"/> 					
              <label for="Field71">MM</label>
          </span> 
          <span class="symbol">/</span> 
          <span> 
              <input id="Field72"	name="d" type="text" class="field text" value="" size="2" maxlength="2" tabindex="8" onkeypress="return nhapSoDate(event);" /> 
              <label for="Field72">DD</label>
          </span>
          <span class="symbol">/</span> 
          <span> 
              <input id="Field73" name="y" type="text" class="field text" value="" size="4"	maxlength="4" tabindex="9" onkeypress="return nhapSoDate(event);" /> 
              <label for="Field73">YYYY</label>
          </span> 
          <span id="cal0"> </span> 
      </li>
  
  
      <li id="foli8" class="date rightHalf">
          <label class="desc" id="title8" for="Field8"> Ngày trả </label> 
          <span> 
              <input 	id="Field81" name="mm" type="text" class="field text" value="" size="2" maxlength="2" tabindex="10" readonly="readonly" /> 		
              <label for="Field81">MM</label>
          </span> 
          <span class="symbol">/</span> 
          <span> 
              <input id="Field82" name="dd" type="text" class="field text" value="" size="2" maxlength="2" tabindex="11" readonly="readonly" /> 		
              <label for="Field3-2">DD</label>
          </span> 
          <span class="symbol">/</span>
          <span> 
              <input id="Field83" name="yy" type="text" class="field text" value="" size="4" maxlength="4" tabindex="12" readonly="readonly" /> 		
              <label for="Field83">YYYY</label>
          </span> 
          <span id="cal3"> </span> 
      </li>
  
  
      <li id="foli9" class="leftHalf">
          <label class="desc" id="title9" for="Field9"> Dịch vụ đi kèm </label>
          <div class="col">
              <span> 
                  <input id="Field91" name="chkAnSang" type="checkbox" class="field checkbox" value="AnSang" tabindex="13" /> 
                  <label class="choice">Ăn sáng</label> 
              </span> 
              <span>
                  <input id="Field192" name="chkGiatUi" type="checkbox" class="field checkbox" value="GiatUi" tabindex="14" /> 
                  <label class="choice">Giặt ủi</label> 
              </span> 
              <span> 
                  <input id="Field193" name="chkSachBao" type="checkbox" class="field checkbox" value="SachBao" tabindex="15" /> 		
                  <label class="choice">Báo buổi sáng</label> 
              </span>
          </div>
      </li>
  
  
      <li id="foli10" class="">
          <label class="desc" id="title10" for="Field10"> Đơn giá một ngày * </label> VNĐ 
          <span> 
              <input	id="Field10" name="txtTinhTien" type="text" class="field text currency" value="" size="30" tabindex="16"  readonly="readonly"/> 
          </span>
      </li>
  
      <li class="buttons ">
          <input id="calculateCost" name="calcCost"	class="btTxt submit" type="button" value="Tính đơn giá"  onfocus="tinhDonGia();"/> 
          <input id="saveForm" name="saveForm" class="btTxt submit" type="submit" value="Đăng ký" />
      </li>
	
	</ul>
</form>
</div>

<!--container-->
<img id="bottom" src="images/bottom.png" alt="" />

</body>
</html>